(function(){var __amdDefs__={},Marx_prototype=function(){var _promise_prototype=function(){!function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this);var t=function(){!function(t){var e,a,s,n,i,r,o,c;t._easeFns=function(){o={easeIn:function(t){return t*t},easeOut:function(t){return-1*t*(t-2)},easeInOut:function(t){return.5>t?t*t:-1*t*(t-2)},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return(1-t)*(1-t)*(1-t)+1},pow:function(t){return Math.pow(t,parseFloat(1.5-t))},linear:function(t){return t}}},t.add=function(t,e,s){if(e||s){var n;"[object Array]"===Object.prototype.toString.call(s)?n=s:(n=Array.prototype.slice.call(arguments,2),n||(n=[])),a.push([e,t,n])}else a.push(t)},t.addEasingFn=function(t,e){o[t]=e},t.after=function(t,e,a){a||(a="aft_"+r++),n[a]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.ease=function(t,e,a,s){var n=o[t];n||(n=o.pow);var i="e_"+r++;c[i]={easeFn:n,duration:e,cb:a,over:s}},t.every=function(t,e,a){a||(a="t7491_"+r++),n[a]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this._easeFns(),r=1;var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}var l=new Function("try { return this == global; } catch(e) { return false; }")();l?t=function(t){return setImmediate(t)}:t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),a=[],s={},n={},i=[],c={};var f=0,_=function(){var e=(new Date).getTime(),r=f-e;0==f&&(r=0);for(var o;o=a.shift();)"[object Array]"===Object.prototype.toString.call(o)?o[1].apply(o[0],o[2]):o();for(var l=0;l<i.length;l++){var u=i[l];u()}for(var d in c)if(c.hasOwnProperty(d)){var h=c[d];h.start||(h.start=e);var m=e-h.start,p=m/h.duration;p>=1&&(p=1,delete c[d]),h.cb(h.easeFn(p)),1==p&&h.over&&h.over()}for(var d in s)if(s.hasOwnProperty(d)){var h=s[d];h[0](h[1]),delete s[d]}for(var d in n)if(n.hasOwnProperty(d)){var h=n[d];h.nextTime<e&&(h.remove?h.nextTime>0?(h.fn(),delete n[d]):h.nextTime=e+h.step:(h.fn(),h.nextTime=e+h.step)),h.until&&h.until<e&&delete n[d]}t(_),f=e};_(),e=!0}}),t.once=function(t,e,a){s[t]=[e,a]},t.onFrame=function(t){i.push(t)},t.removeFrameFn=function(t){var e=i.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),i.splice(e,1),!0):!1}}(this)},e=function(t,a,s,n,i,r,o,c){var l,f=this;if(!(f instanceof e))return new e(t,a,s,n,i,r,o,c);var _=[t,a,s,n,i,r,o,c];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){l=t.apply(f,_)}),"function"==typeof l){if(l._classInfo.name!=e._classInfo.name)return new l(t,a,s,n,i,r,o,c)}else if(l)return l;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,_)}):"function"==typeof f.init&&f.init.apply(f,_)};e._classInfo={name:"later"},e.prototype=new t,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(__amdDefs__.later=e,this.later=e):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.later=e:this.later=e}.call(new Function("return this")()),function(t){t.all=function(t){var e;e=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var a=e.length,s=0,n=[],i=new Array(a);return this.then(function(){var t=_promise();return 0==e.length&&t.resolve([]),e.forEach(function(e,r){e.then?(n.push(e),e.then(function(e){i[r]=e,s++,s==a&&t.resolve(i)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.collect=function(t,e,a){var s;s=this.isArray(e)?e:[e];var n=s.length,i=!1,r=!1,o=0,c=[],l=a||{};return this.then(function(){var e=_promise();return s.forEach(function(a){a.then?(c.push(a),a.then(function(a){o++,i=t(a,l),(i&&!r||0==r&&n==o)&&(e.resolve(l),r=!0)},function(t){e.reject(t)})):e.reject("Not list of promises")}),e})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var e=this._childPromises.length;e--;){var a=this._childPromises.shift();if(a._onFulfill)try{var s=a._onFulfill(t);"undefined"!=typeof s?a.resolve(s):a.fulfill(t)}catch(n){a.reject(n)}else a.fulfill(t)}this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,e){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var a=_promise();return this.then(function(){var s=Array.prototype.slice.call(arguments,0),n=t.concat(s),i=e.apply(this,n);a.resolve(i)},function(t){a.reject(t)}),a})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,a){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(a)&&(this._onReject=a),!a&&this.isFunction(t)){var s=this;e().asap(function(){t(function(t){s.resolve(t)},function(t){s.resolve(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,e){this.plugin(t,function(){var t,a,s=Array.prototype.slice.call(arguments,0),n=0;s.length>=0&&(t=s[s.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(a=t,n=s.length-1));var i=wishes().pending();return this.then(function(){var t=wishes().pending(),r=Array.prototype.slice.call(arguments,0);console.log("Orig args",s),console.log("Then args",r);var o;0==s.length&&(o=r),0==r.length&&(o=s),o||(o=r.concat(s)),n=o.length,a&&n--,o[n]=function(e){if(e)return console.log("Got error ",e),t.reject(e),void i.reject(e);if(a){var s=Array.prototype.slice.call(arguments),n=a.apply(this,s);i.resolve(n)}else{var s=Array.prototype.slice.call(arguments,1);i.resolve.apply(i,s)}},t.then(function(t){i.resolve(t)}),console.log("nodeStyle after concat",o);e.apply(this,o);return t},function(t){i.reject(t)}),i})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(e,a){return t[e]=a,this},t.props=function(t){var e=[];for(var a in t)t.hasOwnProperty(a)&&e.push({name:a,promise:t[a]});var s=e.length,n=0,i=[],r={};return this.then(function(){var t=wishes().pending();return e.forEach(function(e){var a=e.promise,o=e.name;a.then?(i.push(a),a.then(function(e){r[o]=e,n++,n==s&&t.resolve(r)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var e=this._childPromises.length;e--;){var a=this._childPromises.shift();if(a._onReject)try{a._onReject(t),a.reject(t)}catch(s){a.reject(s)}else a.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var e=this;t.onStateChange(function(){1==t._state&&e.resolve(t.value()),2==t._state&&e.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var a=!1;try{var e=this;t.then.call(t,function(t){a||(e.resolve(t),a=!0)},function(t){a||(e.reject(t),a=!0)})}catch(s){a||this.reject(s)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,a){a||(a=function(){});var s=new _promise(t,a),n=this;return 1==this._state&&e().asap(function(){n.fulfill(n.value())}),2==this._state&&e().asap(function(){n.reject(n.rejectReason())}),this._childPromises.push(s),s},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(e){e(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},_promise=function(t,e,a,s,n,i,r,o){var c,l=this;if(!(l instanceof _promise))return new _promise(t,e,a,s,n,i,r,o);var f=[t,e,a,s,n,i,r,o];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"function"==typeof c){if(c._classInfo.name!=_promise._classInfo.name)return new c(t,e,a,s,n,i,r,o)}else if(c)return c;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,f)}):"function"==typeof l.init&&l.init.apply(l,f)};_promise._classInfo={name:"_promise"},_promise.prototype=new _promise_prototype,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(__amdDefs__._promise=_promise,this._promise=_promise):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._promise=_promise:this._promise=_promise}.call(new Function("return this")()),function(_myTrait_){var _callBackHash,_idx,_worker,_initDone,_objRefs,_threadPool,_maxWorkerCnt,_roundRobin,_objPool,_promiseClass,_classDefs,_loadedLibs,_isNode,_processPool;_myTrait_.__promiseClass=function(t){if(t&&(_promiseClass=t),!_promiseClass&&("undefined"!=typeof Promise&&(_promiseClass=Promise),"undefined"!=typeof _promise&&(_promiseClass=_promise),!_promiseClass&&this._isNodeJS()))throw new Error("Promise is not defined");return _promiseClass},_myTrait_._appendToHead=function(t,e){if(!e){e=t;var a=e.split(".");t=a.pop()}var s=this.__promiseClass();return s?(_loadedLibs||(_loadedLibs={}),_loadedLibs[e]?_loadedLibs[e]:(_loadedLibs[e]=new s(function(a,s){var n;return"js"==t&&(n=document.createElement("script"),n.src=e),"css"==t&&(n=document.createElement("link"),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e)),n?(n.onload=function(){a(e)},n.onerror=function(){s(e)},void document.head.appendChild(n)):void s("Unknown element type "+e)}),_loadedLibs[e])):void 0},_myTrait_._baseProcess=function(t){function baseProcess(){this._initDone=!0,this._classes={},this._instances={},this._imports={},this._messageCnt=0,this._execptionCnt=0;var postMessage=function(t){process.send(t)};this.onMsg=function(pData){var msg={data:pData};try{if(this._messageCnt++,"call"==msg.data.cmd&&"/"==msg.data.id){if("heapUsage"==msg.data.fn){var usage={};if(process&&process.memoryUsage){var o=process.memoryUsage();usage={rss:o.rss,heapTotal:o.heapTotal,heapUsed:o.heapUsed,heapUsage:parseInt(100*o.heapUsed/o.heapTotal),fromTotalGb:parseFloat(100*o.heapTotal/1073741824).toFixed(2)}}postMessage({cbid:msg.data.cbid,data:usage})}if("listClasses"==msg.data.fn&&postMessage({cbid:msg.data.cbid,data:{list:Object.keys(this._classes)}}),"classMetrics"==msg.data.fn){var usage={};usage.requireCnt=Object.keys(this._imports).length,usage.instanceCnt=Object.keys(this._instances).length,usage.classCnt=Object.keys(this._classes).length,usage.messageCnt=this._messageCnt,usage.errors=this._execptionCnt,postMessage({cbid:msg.data.cbid,data:usage})}if("createClass"==msg.data.fn){var newClass,dataObj=msg.data.data;if(eval("newClass = "+dataObj.code),dataObj.localMethods){var methods=dataObj.localMethods;for(var n in methods)methods.hasOwnProperty(n)&&!function(t){newClass[t]=function(){for(var e=arguments.length,a=new Array(e),s=0;e>s;s++)a[s]=arguments[s];postMessage({msg:t,data:a,ref_id:this._ref_id})}}(n)}this._classes[dataObj.className]=newClass;try{if(dataObj.requires&&dataObj.requires.js)for(var list=dataObj.requires.js,i=0;i<list.length;i++){var mod=list[i];mod.name&&(mod.assignTo&&mod.varName?global[mod.assignTo]=require(mod.name)[mod.varName]:mod.assignTo&&(global[mod.assignTo]=require(mod.name)))}}catch(e){this._execptionCnt++}postMessage({cbid:msg.data.cbid,data:"Done"})}if("createObject"==msg.data.fn&&msg.data.data){var dataObj=msg.data.data,newClass=this._classes[dataObj.className];if(newClass){var o_instance=Object.create(newClass);this._instances[dataObj.id]=o_instance,o_instance.sendMsg=function(t,e){postMessage({msg:t,data:e,ref_id:dataObj.id})},o_instance.send=o_instance.sendMsg,o_instance._ref_id=dataObj.id,o_instance.init&&o_instance.init(),postMessage({cbid:msg.data.cbid,data:"Done"})}}return}if("call"==msg.data.cmd&&msg.data.id){var ob=this._instances[msg.data.id];if(ob){if("terminate"==msg.data.fn)return console.log("=== Marx TERMINATE Called ==="),ob.terminate&&ob.terminate(),void delete this._instances[msg.data.id];ob[msg.data.fn]&&ob[msg.data.fn].apply(ob,[msg.data.data,function(t){postMessage({cbid:msg.data.cbid,data:t})}])}}}catch(e){console.log("error "+e.message),this._execptionCnt++}}}var base=new baseProcess;process.on("message",function(t){base.onMsg(t)})},_myTrait_._baseWorker=function(t){return{init:function(){this._initDone||(this._initDone=!0,this._classes={},this._instances={},this._imports={})},start:function(msg){if(this.init(),"call"!=msg.data.cmd||"/"!=msg.data.id){if("call"==msg.data.cmd&&msg.data.id){var ob=this._instances[msg.data.id];if(ob){if("terminate"==msg.data.fn)return ob.terminate&&ob.terminate(),void delete this._instances[msg.data.id];ob[msg.data.fn]&&ob[msg.data.fn].apply(ob,[msg.data.data,function(t){postMessage({cbid:msg.data.cbid,data:t})}])}}}else{if("extendClass"==msg.data.fn){var newClass,dataObj=msg.data.data;if(eval("newClass = "+dataObj.code),dataObj.localMethods){var methods=dataObj.localMethods;for(var n in methods)methods.hasOwnProperty(n)&&!function(t){newClass[t]=function(){for(var e=arguments.length,a=new Array(e),s=0;e>s;s++)a[s]=arguments[s];postMessage({msg:t,data:a,ref_id:this._ref_id})}}(n)}for(var nnn in newClass)newClass.hasOwnProperty(nnn)&&(this._classes[dataObj.className][nnn]=newClass[nnn]);try{if(dataObj.requires&&dataObj.requires.js)for(var list=dataObj.requires.js,i=0;i<list.length;i++){var url=list[i].url;this._imports[url]||(importScripts(url),this._imports[url]=!0)}}catch(e){}postMessage({cbid:msg.data.cbid,data:"Done"})}if("createClass"==msg.data.fn){var newClass,dataObj=msg.data.data;if(eval("newClass = "+dataObj.code),dataObj.localMethods){var methods=dataObj.localMethods;for(var n in methods)methods.hasOwnProperty(n)&&!function(t){newClass[t]=function(){for(var e=arguments.length,a=new Array(e),s=0;e>s;s++)a[s]=arguments[s];postMessage({msg:t,data:a,ref_id:this._ref_id})}}(n)}this._classes[dataObj.className]=newClass;try{if(dataObj.requires&&dataObj.requires.js)for(var list=dataObj.requires.js,i=0;i<list.length;i++){var url=list[i].url;this._imports[url]||(importScripts(url),this._imports[url]=!0)}}catch(e){}postMessage({cbid:msg.data.cbid,data:"Done"})}if("createObject"==msg.data.fn&&msg.data.data){var dataObj=msg.data.data,newClass=this._classes[dataObj.className];if(newClass){var o_instance=Object.create(newClass);this._instances[dataObj.id]=o_instance,o_instance.sendMsg=function(t,e){postMessage({msg:t,data:e,ref_id:dataObj.id})},o_instance.send=o_instance.sendMsg,o_instance._ref_id=dataObj.id,o_instance.init&&o_instance.init(),postMessage({cbid:msg.data.cbid,data:"Done"})}}}}}},_myTrait_._callObject=function(t,e,a,s){var n=_objRefs[t];return n&&this._callWorker(_threadPool[n.__wPool],t,e,a,s),this},_myTrait_._callWorker=function(t,e,a,s,n){_worker&&(_callBackHash[_idx]=n,this._isNodeJS()?t.send({cmd:"call",id:e,fn:a,cbid:_idx++,data:s}):t.postMessage({cmd:"call",id:e,fn:a,cbid:_idx++,data:s}))},_myTrait_._collectMemoryUsage=function(t,e){var a=0;for(var s in _threadPool)a++;var n=[],i=this;for(var s in _threadPool)!function(s){i._callWorker(_threadPool[s],"/",t,{},function(t){t.name="Worker Process "+s,a--,n.push(t),0==a&&e(n)})}(s);return this},_myTrait_._createProcess=function(t,e){try{if("undefined"==typeof t&&_worker)return _worker;var a=require("child_process"),s=a.fork(e);return _callBackHash||(_callBackHash={},_idx=1),_worker=s,s.on("message",function(t){if("object"!=typeof t)console.error("Unknown message from the worker ",t);else{if(t.cbid){var e=_callBackHash[t.cbid];e&&(delete _callBackHash[t.cbid],e(t.data))}if(t.ref_id){var a=_objRefs[t.ref_id];if(a){var s=(t.data,t.msg);if(a[s]){var n=_classDefs[a.__wClass];if(n&&n.methods[s])return void a[s].apply(a,t.data)}a.trigger&&a.trigger(t.msg,t.data)}}}}),"undefined"!=typeof t&&(_threadPool[t]=s),s}catch(n){return null}},_myTrait_._createWorker=function(t){try{if("undefined"==typeof t&&_worker)return _worker;var e="var o = "+this._serializeClass(this._baseWorker())+"\n onmessage = function(eEvent) { o.start.apply(o, [eEvent]); } ",a=new Blob([e],{type:"text/javascript"}),s=new Worker(window.URL.createObjectURL(a));return _callBackHash||(_callBackHash={},_idx=1),_worker=s,s.onmessage=function(t){if("object"!=typeof t.data)console.error("Unknown message from the worker ",t.data);else{if(t.data.cbid){var e=_callBackHash[t.data.cbid];delete _callBackHash[t.data.cbid],e(t.data.data)}if(t.data.ref_id){var a=_objRefs[t.data.ref_id];if(a){var s=(t.data.data,t.data.msg);if(a[s]){var n=_classDefs[a.__wClass];if(n&&n.methods[s])return void a[s].apply(a,t.data.data)}a.trigger&&a.trigger(t.data.msg,t.data.data)}}}},"undefined"!=typeof t&&(_threadPool[t]=s),s}catch(n){return null}},_myTrait_._createWorkerClass=function(t,e,a,s,n){var i=this.__promiseClass(),r=this;_classDefs||(_classDefs={});var o="createClass";return n&&(o="extendClass"),new i(function(c){var l,f;if(n)for(var _ in s)s.hasOwnProperty(_)&&(_classDefs[t].methods[_]=s[_]);else _classDefs[t]={methods:s};for(var u=r._serializeClass(e),d=0;_maxWorkerCnt>d;d++)!function(e){l?l=l.then(function(){return new i(function(n){r._callWorker(_threadPool[e],"/",o,{className:t,code:u,requires:a,localMethods:s},n)})}):f=l=new i(function(n){r._callWorker(_threadPool[e],"/",o,{className:t,code:u,requires:a,localMethods:s},n)})}(d);l.then(function(){c(!0)})})},_myTrait_._createWorkerObj=function(t,e,a){var s=this.__promiseClass(),n=this;return new s(function(s){var i=_roundRobin++%_maxWorkerCnt;a.__wPool=i,a.__wClass=t,_objRefs[e]=a,n._callWorker(_threadPool[i],"/","createObject",{className:t,id:e},function(t){s(t)})})},_myTrait_._isNodeJS=function(){return"undefined"==typeof _isNode&&(_isNode=new Function("try { return this == global; } catch(e) { return false; }")()),_isNode},_myTrait_._metrics=function(t,e){return this._collectMemoryUsage(t,e)},_myTrait_._nodeChildProcess=function(){},_myTrait_._serializeClass=function(t){var e="{",a=0;for(var s in t)a++&&(e+=","),e+=s+" : "+t[s].toString();return e+="};"},_myTrait_._workersAvailable=function(){return _worker},_myTrait_.createClass=function(t){var e={},a=this,s={},n=[];if(this._workersAvailable()){var i=t.webWorkers||t.processWorkers;for(var r in i)i.hasOwnProperty(r)&&!function(t){e[t]=function(e,s){e||(e=null),a._callObject(this._id,t,e,s)}}(r);var o=t.methods;for(var r in o)o.hasOwnProperty(r)&&!function(t,a){s[a]=a,e[a]=t}(o[r],r)}else{console.log("** workers are not available **");var c=t.requires;for(var l in c)if("js"==l){var f=c[l];f.forEach(function(t){n.push(a._appendToHead("js",t.url))})}var i=t.webWorkers;for(var r in i)i.hasOwnProperty(r)&&!function(t,a){e[a]=function(e,a){t.apply(this,[e,a])}}(i[r],r);var o=t.methods;for(var r in o)o.hasOwnProperty(r)&&(s[r]=r,function(t,a){e[a]=function(e,a){t.apply(this,[e,a])}}(o[r],r))}e.on=function(t,e){this.__evt||(this.__evt={}),this.__evt[t]||(this.__evt[t]=[]),this.__evt[t].push(e)},e.trigger=function(t,e){if(this.__evt&&this.__evt[t]){var a=this;this.__evt[t].forEach(function(t){t.apply(a,[e])})}};var _=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);s.trigger="trigger";var a=this,u=this.__promiseClass();if(this._workersAvailable()){var d=this._createWorkerClass(_,t.webWorkers||t.processWorkers,t.requires,s),h=function(t){t||(t=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)),this._id=t;var e=this;return new u(function(s){d.then(function(){a._createWorkerObj(_,t,e).then(function(){e.trigger("ready"),s(e)})})})};h.prototype=e}else{var h=function(t){t||(t=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)),this._id=t;var e=this;return new u(function(t){if(0==n.length)return void t(e);for(var a,s=n.pop();a=n.pop();)s=s.then(function(){return a});s.then(function(){t(e)})})};h.prototype=e}return h.extendClass=function(t){var n=t.webWorkers||t.processWorkers;for(var i in n)n.hasOwnProperty(i)&&!function(t){e[t]=function(e,s){e||(e=null),a._callObject(this._id,t,e,s)}}(i);var r=t.methods;for(var i in r)r.hasOwnProperty(i)&&!function(t,a){s[a]=a,e[a]=t}(r[i],i);return a._createWorkerClass(_,t.webWorkers||t.processWorkers,t.requires,s,!0)},h},_myTrait_.__traitInit&&!_myTrait_.hasOwnProperty("__traitInit")&&(_myTrait_.__traitInit=_myTrait_.__traitInit.slice()),_myTrait_.__traitInit||(_myTrait_.__traitInit=[]),_myTrait_.__traitInit.push(function(t){if(!_initDone){if(t||(t={}),_initDone=!0,_maxWorkerCnt=t.processCnt||4,_roundRobin=0,_threadPool=[],_objRefs={},_processPool=[],t.isChild)return;if(this._isNodeJS())for(var e=0;_maxWorkerCnt>e;e++)this._createProcess(e,t.forkFile);else for(var e=0;_maxWorkerCnt>e;e++)this._createWorker(e)}})}(this)},Marx=function(t,e,a,s,n,i,r,o){var c,l=this;if(!(l instanceof Marx))return new Marx(t,e,a,s,n,i,r,o);var f=[t,e,a,s,n,i,r,o];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"function"==typeof c){if(c._classInfo.name!=Marx._classInfo.name)return new c(t,e,a,s,n,i,r,o)}else if(c)return c;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,f)}):"function"==typeof l.init&&l.init.apply(l,f)};Marx._classInfo={name:"Marx"},Marx.prototype=new Marx_prototype,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(__amdDefs__.Marx=Marx,this.Marx=Marx):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.Marx=Marx:this.Marx=Marx}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(__amdDefs__)}).call(new Function("return this")());